{% extends "base.html" %}
{% block content %}

<!-- Welcome message moved to the top, centralized, and adjusted for one-line fit -->
<div class="welcome-message" style="text-align: center; margin-top: 20px;">
    <h1 style="font-size: 1.5em;">Welcome to Ephemeral Notes ‚Äî where messages self-destruct (on purpose)!</h1>
    <p>Write it, share it, and poof ‚Äî it‚Äôs gone. No footprints, no snoops, just pure, short-lived magic.</p>
</div>

<div class="row gy-4 align-items-stretch">
  <!-- Statistics Section -->
  <div class="col-md-4 d-flex flex-column">
    <div class="row gx-3 mb-3">
      <div class="col-12 col-md-6">
        <div class="card shadow-sm stat-card">
          <div class="card-body text-center">
            <h6 class="text-muted mb-1"><span class="stat-emoji">üóÇÔ∏è</span>Total Notes</h6>
            <div class="stat-number">{{ total }}</div>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-6">
        <div class="card shadow-sm stat-card">
          <div class="card-body text-center">
            <h6 class="text-muted mb-1"><span class="stat-emoji">üî•</span>Active</h6>
            <div class="stat-number">{{ active_notes }}</div>
          </div>
        </div>
      </div>
    </div>
    

    <div class="card shadow-sm flex-grow-1">
      <div class="card-body d-flex flex-column">
        <h6 class="text-muted">Recent Notes</h6>
        <div class="table-responsive flex-grow-1">
          <table class="table table-sm table-hover mb-0 recent-table">
            <thead>
              <tr>
                <th>Token</th>
                <th>TTL</th>
                <th>Created</th>
              </tr>
            </thead>
            <tbody>
              {% for n in notes %}
              <tr>
                <td class="font-monospace token-cell">{{ n.token_mask }}</td>
                <td>{{ n.ttl_seconds }}</td>
                <td class="text-nowrap small text-muted">{{ n.created_at_display }}</td>
              </tr>
              {% else %}
              <tr><td colspan="3" class="text-muted">No notes found.</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Note Creation Form -->
  <div class="col-md-8">
    <div class="card shadow-sm h-100">
      <div class="card-body d-flex flex-column">
        <div class="d-flex justify-content-between align-items-start mb-2">
          <div>
            <h1 class="h4 mb-1" style="color:#0b1220; font-weight:700;">Create a New Note</h1>
            <p class="text-muted-small mb-0">Enter your private note below. It will be deleted automatically after the selected time.</p>
          </div>
          <div class="text-end">
            <small class="text-muted-small">Max 20,000 chars</small>
          </div>
        </div>

        {% if error %}
        <div class="alert alert-danger" role="alert">{{ error }}</div>
        {% endif %}

  <form method="post" action="{{ url_for('create_note') }}" class="needs-validation d-flex flex-column h-100" novalidate>
          <div class="mb-3 d-flex flex-column flex-grow-1">
            <label for="content" class="form-label">Note:</label>
            <textarea id="content" name="content" rows="6" class="form-control flex-grow-1" style="min-height:140px;" maxlength="20000" required
              aria-describedby="contentHelp" placeholder="Meeting notes ‚Äî e.g. discuss Q4 roadmap...">{{ request.form.content or '' }}</textarea>
            <div class="d-flex justify-content-between align-items-center mt-1 form-helpers">
              <div id="contentHelp" class="form-text small text-muted">Whitespace preserved on view.</div>
              <div class="form-text text-muted-small small"><span id="charCount">0</span> chars</div>
            </div>
          </div>

          {% if feature_flags.custom_ttl %}
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="ttl" class="form-label">Expiration Time</label>
              <select id="ttl" name="ttl" class="form-select">
                {% for t in ttl_choices %}
                <option value="{{ t }}" {% if t == default_ttl %}selected{% endif %}>{{ labels[t] }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Options</label>
              <div class="row g-2">
                {% if feature_flags.password_protect %}
                <div class="col-12">
                  <input id="password" name="password" type="password" class="form-control" placeholder="Optional password" minlength="6" />
                  <div class="form-text small text-muted">Add a password to restrict viewing.</div>
                </div>
                {% endif %}
                {% if feature_flags.markdown %}
                <div class="col-auto">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="1" id="markdown" name="markdown">
                    <label class="form-check-label" for="markdown">Markdown</label>
                  </div>
                </div>
                {% endif %}
                {% if feature_flags.burn_after_read %}
                <div class="col-auto">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="1" id="burn_after_read" name="burn_after_read">
                    <label class="form-check-label" for="burn_after_read">Burn after view</label>
                  </div>
                </div>
                {% endif %}
              </div>
            </div>
          </div>
          {% endif %}

          <div class="mt-3"></div>
          <div class="mt-auto d-flex gap-2">
            <button type="submit" class="btn btn-dark" id="createNoteBtn">Create Note</button>
            <a class="btn btn-outline-secondary" href="{{ url_for('index') }}">Reset</a>
          </div>
        </form>

      </div>
    </div>
    <div class="mt-3 text-muted small text-center">
      <p>Note: Links are unguessable tokens. For higher secrecy, consider client-side encryption (not enabled).</p>
      <p class="small text-muted mt-2">Notes are stored securely and auto-expire after the set time.</p>
    </div>
  </div>
</div>

<script>
// live character counter
document.addEventListener('DOMContentLoaded', function(){
  var ta = document.getElementById('content');
  var counter = document.getElementById('charCount');
  if(!ta || !counter) return;
  function update(){ counter.innerText = ta.value.length; }
  ta.addEventListener('input', update);
  update();
});
</script>

{% endblock %}
